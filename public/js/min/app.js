angular.module("bmuApp",["wu.masonry","ngAnimate","ngSanitize","ui.bootstrap","flow","angular-jwt","angular-storage","ui.router","ngFileUpload","ngTouch","infinite-scroll","angular-images-loaded","pusher-angular","ngImgCrop","720kb.tooltips","uiGmapgoogle-maps","bmuApp.routes","bmuApp.login","bmuApp.signup","bmuApp.posts","bmuApp.pmessenger","bmuApp.profile"]).config(["$urlRouterProvider","$urlMatcherFactoryProvider","jwtInterceptorProvider","$httpProvider","$locationProvider",function($urlRouterProvider,$urlMatcherFactoryProvider,jwtInterceptorProvider,$httpProvider,$locationProvider){$locationProvider.html5Mode(!0),$urlRouterProvider.otherwise("/"),$urlMatcherFactoryProvider.strictMode(!1),jwtInterceptorProvider.tokenGetter=function(store){return store.get("jwt")},$httpProvider.interceptors.push("jwtInterceptor")}]).run(["$rootScope","$state","$stateParams","store","jwtHelper","UserService",function($rootScope,$state,$stateParams,store,jwtHelper,UserService){$rootScope.$on("$stateChangeStart",function(e,to,toParams){$rootScope.isLoggedIn&&("signupState"!==to.name&&"loginState"!==to.name||(e.preventDefault(),$state.go("homeState")),"otherProfileState"===to.name&&toParams.id==$rootScope.currentUser.id&&(e.preventDefault(),$state.go("profileState"))),to.data&&to.data.requiresLogin&&(store.get("jwt")&&!jwtHelper.isTokenExpired(store.get("jwt"))||(e.preventDefault(),$state.go("homeState")))})}]),angular.module("bmuApp").constant("URL_BASE","blackmarketu.com/"),angular.module("bmuApp").config(["flowFactoryProvider",function(flowFactoryProvider){flowFactoryProvider.defaults={target:"",permanentErrors:[500,501],maxChunkRetries:1,chunkRetryInterval:5e3,simultaneousUploads:1},flowFactoryProvider.on("catchAll",function(event){})}]),angular.module("bmuApp").config(["uiGmapGoogleMapApiProvider",function(uiGmapGoogleMapApiProvider){uiGmapGoogleMapApiProvider.configure({v:"3.20",libraries:"weather,geometry,visualization"})}]),angular.module("bmuApp").controller("reportPostModal",["$scope","$uibModal","$log",function($scope,$uibModal,$log){$scope.animationsEnabled=!0,$scope.openReport=function(size,_post,_posts){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"reportPostModal.html",controller:"ReportModalInstanceCtrl",size:size,resolve:{post:function(){return _post},posts:function(){return _posts}}});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled}}]),angular.module("bmuApp").controller("addPostModal",["$scope","$uibModal","$log",function($scope,$uibModal,$log){$scope.animationsEnabled=!0,$scope.open=function(size){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"addPostModal.html",controller:"ModalInstanceCtrl",size:size});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled}}]),angular.module("bmuApp").controller("editPostModal",["$scope","$uibModal","$log",function($scope,$uibModal,$log){$scope.animationsEnabled=!0,$scope.openEdit=function(_post){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"editPostModal.html",controller:"EditModalInstanceCtrl",resolve:{post:function(){return _post}}});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled}}]),angular.module("bmuApp").controller("ReportModalInstanceCtrl",["$scope","$http","$state","Upload","$rootScope","$uibModalInstance","post","posts",function($scope,$http,$state,Upload,$rootScope,$uibModalInstance,post,posts){$scope.categories=$rootScope.categories,$scope.item={},$scope.posting=!1,$scope.post=post,$scope.posts=posts,$scope.setFormScope=function(scope){this.formScope=scope},$scope.uploadReport=function(){$scope.posting=!0,"other"===$scope.report.reason&&($scope.report.reason=$scope.report.oreason),$http({url:"https://www.blackmarketu.com/api/posts/report",method:"POST",data:{"post-id":$scope.post.id,reason:$scope.report.reason}}).then(function(data){$scope.posting=!1,$scope.posts.splice($scope.posts.indexOf($scope.post),1),$scope.close()}).then(function(error){console.log(error)})},$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("bmuApp").controller("EditModalInstanceCtrl",["$scope","$http","$state","Upload","$rootScope","$uibModalInstance","post",function($scope,$http,$state,Upload,$rootScope,$uibModalInstance,post){$scope.categories=$rootScope.categories,$scope.item={},$scope.itemImages=[],$scope.posting=!1,$scope.post=post,$scope.setFiles=function($files){$scope.itemImages.length<3&&$scope.itemImages.length+$files.length<=3&&Array.prototype.push.apply($scope.itemImages,$files),console.log($scope.itemImages)},$scope.deleteImage=function($item){$scope.itemImages.splice($item,1)},$scope.setFormScope=function(scope){this.formScope=scope},$scope.item.desc=$scope.post.content,$scope.item.name=$scope.post.title,$scope.item.price=parseFloat($scope.post.price),$scope.uploadPost=function(){$scope.posting=!0,$http({url:"https://www.blackmarketu.com/api/posts/edit",method:"POST",data:{price:$scope.item.price,title:$scope.item.name,content:$scope.item.desc,"post-id":$scope.post.id}}).then(function(data){$scope.post.content=$scope.item.desc,$scope.post.title=$scope.item.name,$scope.post.price=$scope.item.price,$scope.posting=!1,$scope.close()}).then(function(error){console.log(error)})},$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("bmuApp").controller("ModalInstanceCtrl",["$scope","$http","$state","Upload","$rootScope","$uibModalInstance",function($scope,$http,$state,Upload,$rootScope,$uibModalInstance){$scope.categories=$rootScope.categories,$scope.item={},$scope.itemImages=[],$scope.posting=!1,$scope.setFiles=function($files){$scope.itemImages.length<3&&$scope.itemImages.length+$files.length<=3&&Array.prototype.push.apply($scope.itemImages,$files),console.log($scope.itemImages)},$scope.deleteImage=function($item){$scope.itemImages.splice($item,1)},$scope.setFormScope=function(scope){this.formScope=scope},$scope.uploadPost=function(files){$scope.imageError=!1,item=$scope.item,$scope.itemImages&&$scope.itemImages.length?($scope.posting=!0,Upload.base64DataUrl($scope.itemImages).then(function(urls){$scope.itemImages.upload=Upload.upload({url:"https://blackmarketu.com/api/posts/create",data:{"item-image":urls,"item-title":item.name,"item-price":item.price,"item-description":item.desc,"category-id":item.category}}),$scope.itemImages.upload.then(function(response){$scope.posting=!1,$rootScope.addPostToFrontPage(response),$scope.close()},function(response){console.log(response),$scope.posting=!1})})):($scope.imageError=!0,console.log("Invalid"))},$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("bmuApp").directive("searchAble",["$state","$stateParams",function($state,$stateParams){return{restrict:"A",link:function(scope,element,attrs){scope.$watch($stateParams.query,function(param){param&&(console.log(),attrs.ngModel=param.query)}),scope.$watch(attrs.ngModel,function(v){v&&$state.go("searchState",{query:v})})}}}]),angular.module("bmuApp").directive("messageNoti",["$timeout",function($timeout){return{scope:{alert:"=messageNoti",alerts:"=messageArray"},restrict:"EA",templateUrl:"/partials/authenticated/homepage/alerts.html",link:function(scope,element,attrs){$timeout(function(){element.addClass("fadeOut"),$timeout(function(){element.remove(),scope.alerts.splice(alert,1)},500)},5e3),element.on("$destroy",function(){scope.$destroy()})}}}]),angular.module("bmuApp").run(["$rootScope","UserService","$pusher",function($rootScope,UserService,$pusher){$rootScope.alerts=[],$rootScope.currentUserId;var connected=!1;$rootScope.$watch(UserService.currentUser,function(user){if($rootScope.currentUser=user,$rootScope.currentUserId=user.id,$rootScope.currentUser.hasOwnProperty("id")&&!connected){connected=!0;var client=new Pusher("f30782470c4ffc2c0651",{authEndpoint:"https://www.blackmarketu.com/api/private-chat/auth",auth:{headers:{Authorization:"Bearer "+localStorage.getItem("jwt")}}}),pusher=$pusher(client),channel_name="private-"+$rootScope.currentUser.id,private_channel=pusher.subscribe(channel_name);private_channel.bind("private-message-alert",function(data){$rootScope.alerts.push(data),console.log($rootScope.alerts)})}}),$rootScope.categories=[{id:null,name:"Choose category",selectable:!0},{id:null,name:"Buy & Sell",selectable:!0},{id:0,name:"Miscellaneous",selectable:!1},{id:1,name:"Clothing / Accessories",selectable:!1},{id:2,name:"Furniture / Homegoods",selectable:!1},{id:3,name:"Electronics",selectable:!1},{id:4,name:"Books",selectable:!1},{id:5,name:"Tickets",selectable:!1},{id:6,name:"Sports & Leisure",selectable:!1},{id:null,name:"Bulletin Board",selectable:!0},{id:7,name:"Events",selectable:!1},{id:8,name:"Questions",selectable:!1},{id:9,name:"Clubs / Activities",selectable:!1},{id:10,name:"Services",selectable:!1},{id:null,name:"Rideshare",selectable:!0},{id:11,name:"Rideshare",selectable:!1},{id:null,name:"Jobs & Internships",selectable:!0},{id:12,name:"Jobs",selectable:!1},{id:13,name:"Internships",selectable:!1},{id:null,name:"Housing",selectable:!0},{id:14,name:"Housing",selectable:!1},{id:null,name:"Lost & Found",selectable:!0},{id:15,name:"Lost & Found",selectable:!1}]}]),angular.module("bmuApp").filter("slice",function(){return function(arr,start,end){return arr.slice(start,end)}}),angular.module("bmuApp.login",["ui.router","angular-storage","angular-jwt"]).controller("logincontroller",["$scope","$http","store","$state","$stateParams","URL_BASE","UserService","$rootScope",function($scope,$http,store,$state,$stateParams,URL_BASE,UserService,$rootScope){$scope.user={},$scope.loginMessage=$stateParams.message,$scope.login=function(){UserService.login($scope.user)||($scope.loginAlert="Login failed! Please make sure email and password are correct.")}}]),angular.module("bmuApp.login").controller("logoutcontroller",["$scope","$http","store","$state","URL_BASE","UserService","$rootScope",function($scope,$http,store,$state,URL_BASE,UserService,$rootScope){UserService.logout()}]),angular.module("bmuApp.login").directive("autoFillSync",["$timeout",function($timeout){return{require:"ngModel",link:function(scope,elem,attrs,ngModel){var origVal=elem.val();$timeout(function(){var newVal=elem.val();ngModel.$pristine&&origVal!==newVal&&ngModel.$setViewValue(newVal)},500)}}}]),angular.module("bmuApp.login").controller("forgotcontroller",["$scope","$http","store","$state","URL_BASE","UserService","$rootScope",function($scope,$http,store,$state,URL_BASE,UserService,$rootScope){}]),angular.module("bmuApp.login").run(["$rootScope","UserService","$state",function($rootScope,UserService,$state){UserService.getUser(),$rootScope.$watch(UserService.isLoggedIn,function(isLoggedIn){UserService.getUser(),$rootScope.currentUser=UserService.currentUser(),$rootScope.isLoggedIn=isLoggedIn,$rootScope.isLoggedIn})}]),angular.module("bmuApp.pmessenger",["ui.router","angular-storage","angular-jwt","pusher-angular"]).controller("messagescontroller",["$scope","$http","store","$state","$stateParams","UserService","$pusher","$rootScope",function($scope,$http,store,$state,$stateParams,UserService,$pusher,$rootScope){$rootScope.addRoute=function(url){return"https://www.blackmarketu.com/"+url},$scope.threads,$scope.message={},$scope.currentUser=$rootScope.currentUser,$rootScope.getThreads=function(){$http({url:"https://www.blackmarketu.com/api/private-chat",method:"GET"}).then(function(data){Array.isArray(data.data)?$scope.threads=data.data:$scope.threads="No threads for this user"}).then(function(error){$scope.error=error})},$rootScope.getThreads()}]),angular.module("bmuApp.pmessenger").controller("messageslistcontroller",["$scope","$http","store","$state","UserService","$pusher","$stateParams","$rootScope",function($scope,$http,store,$state,UserService,$pusher,$stateParams,$rootScope){$http({url:"https://www.blackmarketu.com/api/users/"+$stateParams.id,method:"GET"}).then(function(data){$scope.toUser=data.data}).then(function(data){$scope.notFound}),$scope.initPusher=function(id){var client=new Pusher("f30782470c4ffc2c0651",{authEndpoint:"https://www.blackmarketu.com/api/private-chat/auth",auth:{headers:{Authorization:"Bearer "+localStorage.getItem("jwt")}}}),pusher=$pusher(client);pusher.subscribe("private-"+id.toString());pusher.bind("new-private-message",function(data){$scope.messages.push(data),$rootScope.getThreads()})},$scope.initPusher($stateParams.id),$scope.newMessage={},$http({url:"https://www.blackmarketu.com/api/private-chat/"+$stateParams.id,method:"GET"}).then(function(data){$scope.messages=data.data.messages.reverse(),$scope.otherUser=data.data.otherUser}).then(function(error){}),$scope.sendMessage=function(){message=$scope.newMessage.message,$scope.newMessage.message="",$http({url:"https://www.blackmarketu.com/api/private-chat",method:"POST",data:{"thread-id":$stateParams.id,message:message}}).then(function(data){$rootScope.getThreads()}).then(function(data){})}}]),angular.module("bmuApp.pmessenger").controller("newmessagecontroller",["$scope","$http","store","$state","UserService","$pusher","$stateParams",function($scope,$http,store,$state,UserService,$pusher,$stateParams){$scope.newMessage={},$scope.toUser={},$http({url:"https://www.blackmarketu.com/api/users/"+$stateParams.id,method:"GET"}).then(function(data){$scope.toUser=data.data}).then(function(data){}),$scope.sendMessage=function(){message=$scope.newMessage.message,$scope.newMessage.message="",$http({url:"https://www.blackmarketu.com/api/private-chat",method:"POST",data:{"to-user":$stateParams.id,message:message}}).then(function(data){console.log(data),data.data.hasOwnProperty("private_message")?($state.go("messages",{id:data.data.private_message.thread_id}),$rootScope.getThreads()):data.data.hasOwnProperty("message")&&$state.go("messages",{id:data.data.message.thread_id})}).then(function(data){console.log(data)})}}]),angular.module("bmuApp").directive("scrollStick",function(){return{scope:{scrollStick:"="},link:function(scope,element){scope.$watchCollection("scrollStick",function(newValue){newValue&&$(element).scrollTop($(element)[0].scrollHeight)})}}}),angular.module("bmuApp").directive("enterSubmit",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.enterSubmit)}),event.preventDefault())})}}),angular.module("bmuApp.posts",["ui.router","angular-storage","angular-jwt","ngFileUpload","angular-images-loaded","720kb.tooltips"]).controller("postscontroller",["$scope","$http","$state","UserService","Upload","$rootScope","URL_BASE",function($scope,$http,$state,UserService,Upload,$rootScope,URL_BASE){$scope.posts=[],$rootScope.addPostToFrontPage=function(post){$scope.posts.unshift(post.data)},$scope.currentPage=1;var noMorePosts=!1;$scope.isBusy=!1,$scope.imgLoadedEvents={always:function(instance){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded-ed animated fadeIn"),$rootScope.$broadcast("masonry.reload")},fail:function(instance){}},$scope.number=6,$scope.getNumber=function(num){return new Array(num)},$rootScope.activeMenu=void 0,$rootScope.openMenu=1,$rootScope.setOpen=function(id){console.log(id),$rootScope.openMenu===id?$rootScope.openMenu=void 0:$rootScope.openMenu=id},$rootScope.addRoute=function(path){return"https://www.blackmarketu.com"+path},$scope.loadMorePosts=function(){$scope.isBusy!==!0&&($scope.isBusy=!0,noMorePosts||($http({url:"https://"+URL_BASE+"api/posts?page="+$scope.currentPage,method:"GET"}).then(function(data){Array.prototype.push.apply($scope.posts,data.data.posts),data.data.posts.length<4&&(noMorePosts=!0,console.log(data.data)),$scope.isBusy=!1},function(error){$scope.response=error.data}),$scope.currentPage++))}}]),angular.module("bmuApp.posts").controller("categorycontroller",["$scope","$http","store","$stateParams","$state","URL_BASE","UserService","$rootScope",function($scope,$http,store,$stateParams,$state,URL_BASE,UserService,$rootScope){$scope.$on("LastRepeaterElement",function(){$rootScope.$broadcast("masonry.reload")}),$scope.imgLoadedEvents={always:function(instance){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded-ed animated fadeIn"),$rootScope.$broadcast("masonry.reload")},fail:function(instance){}},$rootScope.setActive=function(id){void 0!=$stateParams.id?$rootScope.activeMenu=id:$rootScope.activeMenu=0},$scope.posts=[],$rootScope.addRoute=function(path){return"https://www.blackmarketu.com"+path};$scope.slides=[];$scope.currentPage=1;var noMorePosts=!1;$scope.isBusy=!1,$scope.loadMorePosts=function(){$scope.isBusy!==!0&&($scope.isBusy=!0,noMorePosts||($http({url:"https://"+URL_BASE+"api/posts?category[]="+$stateParams.id+"&page="+$scope.currentPage,method:"GET"}).then(function(data){Array.prototype.push.apply($scope.posts,data.data.posts),data.data.posts.length<4&&(noMorePosts=!0),$scope.isBusy=!1},function(error){$scope.response=error.data}),$scope.currentPage++))}}]).controller("searchcontroller",["$scope","$http","store","$stateParams","$state","URL_BASE","UserService","$rootScope",function($scope,$http,store,$stateParams,$state,URL_BASE,UserService,$rootScope){$scope.$on("LastRepeaterElement",function(){$rootScope.$broadcast("masonry.reload")}),$scope.imgLoadedEvents={always:function(instance){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded-ed animated fadeIn"),$rootScope.$broadcast("masonry.reload")},fail:function(instance){}},$scope.posts=[],$rootScope.addRoute=function(path){return"https://www.blackmarketu.com"+path},$scope.currentPage=1;var noMorePosts=!1;$scope.isBusy=!1,$scope.loadMorePosts=function(){$scope.isBusy!==!0&&($scope.isBusy=!0,noMorePosts||($http({url:"https://blackmarketu.com/api/posts/search?query="+$stateParams.query+"&page="+$scope.currentPage,method:"GET"}).then(function(data){Array.prototype.push.apply($scope.posts,data.data.posts),console.log(data),data.data.length<4&&(noMorePosts=!0),$scope.isBusy=!1},function(error){console.log(error.data.error)}),$scope.currentPage++))}}]),angular.module("bmuApp").directive("likePost",["$http","$timeout",function($http,$timeout){return{scope:{post:"=thePost",posts:"=thePosts"},restrict:"EA",replace:!0,template:"<i class='fa fa-heart-o icons right heart'></i>",link:function(scope,element,attrs){scope.post.likes.isLiked&&element.removeClass("fa-heart-o").addClass("fa-heart liked animated bounceIn"),element.bind("click",function(e){$http({url:"https://blackmarketu.com/api/posts/like",method:"POST",data:{"post-id":scope.post.id}}).then(function(data){scope.post.likes.isLiked?scope.post.likes.isLiked=!1:scope.post.likes.isLiked||(scope.post.likes.isLiked=!0),element.hasClass("fa-heart-o")?(element.removeClass("fa-heart-o animated bounceIn"),$timeout(function(){element.addClass("fa-heart liked animated bounceIn")},1),scope.post.likes.likes++):element.hasClass("fa-heart liked")&&(element.removeClass("fa-heart liked animated bounceIn"),$timeout(function(){element.addClass("fa-heart-o animated bounceIn")},1),scope.post.likes.likes--)}).then(function(error){})})}}}]),angular.module("bmuApp").directive("messageUser",["$compile","UserService","$state",function($compile,UserService,$state){return{scope:{post:"=thePost",posts:"=thePosts"},restrict:"EA",replace:!0,template:"<i class='fa fa-comment-o icons right message'></i>",link:function(scope,element,attrs){element.bind("click",function(e){scope.post.user_id!=UserService.currentUser().id?(element.removeClass("fa-comment-o").addClass("fa-comment messaged"),$state.go("newMessageState",{id:scope.post.user_id})):console.log("Your post")})}}}]),angular.module("bmuApp").directive("deletePost",["$http","$rootScope",function($http,$rootScope){return{scope:{post:"=thePost",posts:"=thePosts"},restrict:"EA",link:function(scope,element,attr){element.bind("click",function(){scope.post.deleting=!0,$http({url:"https://blackmarketu.com/api/posts/delete/"+scope.post.id,method:"GET"}).then(function(data){scope.post.deleting=!1,scope.posts.splice(scope.posts.indexOf(scope.post),1),$rootScope.$broadcast("masonry.reload")}).then(function(error){console.log(error)})})}}}]),angular.module("bmuApp").directive("editPost",["$http","$rootScope",function($http,$rootScope){return{scope:{post:"=thePost",posts:"=thePosts"},restrict:"EA",link:function(scope,element,attr){element.bind("click",function(){scope.post.deleting=!0,$http({url:"https://blackmarketu.com/api/posts/delete/"+scope.post.id,method:"GET"}).then(function(data){scope.post.deleting=!1,scope.posts.splice(scope.posts.indexOf(scope.post),1),$rootScope.$broadcast("masonry.reload")}).then(function(error){console.log(error)})})}}}]),angular.module("bmuApp").directive("markAsSold",["$http","$rootScope",function($http,$rootScope){return{scope:{post:"=thePost",posts:"=thePosts"},restrict:"EA",link:function(scope,element,attr){element.bind("click",function(){scope.post.deleting=!0,$http({url:"https://blackmarketu.com/api/posts/sold/",method:"POST",data:{"post-id":scope.post.id}}).then(function(data){scope.post.deleting=!1,scope.post.sold=!0}).then(function(error){console.log(error)})})}}}]),angular.module("bmuApp.profile",["ui.router","angular-storage","ngFileUpload"]).controller("profilecontroller",["$scope","$http","$state","UserService","Upload","$rootScope","$stateParams","URL_BASE","$timeout","uiGmapGoogleMapApi",function($scope,$http,$state,UserService,Upload,$rootScope,$stateParams,URL_BASE,$timeout,uiGmapGoogleMapApi){var noMorePosts=!1;$scope.hasPosts=!1,$scope.currentPage=1,$scope.posts=[],$scope.isBusy=!1,$scope.updatePassword={},$scope.newItem,$scope.tradelist=[],$scope.map={center:{latitude:44.473101,longitude:-73.204124},zoom:16},$scope.options={scrollwheel:!1},$scope.coordsUpdates=0,$scope.dynamicMoveCtr=0,$scope.marker={id:0,coords:{latitude:44.473101,longitude:-73.204124},options:{draggable:!1},events:{}},$scope.$watchCollection("marker.coords",function(newVal,oldVal){_.isEqual(newVal,oldVal)||$scope.coordsUpdates++}),$timeout(function(){$scope.marker.coords={latitude:44.473101,longitude:-73.204124},$scope.dynamicMoveCtr++,$timeout(function(){$scope.marker.coords={latitude:44.473101,longitude:-73.204124},$scope.dynamicMoveCtr++},2e3)},1e3),$rootScope.$watch(UserService.currentUser,function(user){$scope.currentUser=$rootScope.currentUser,$scope.loadMorePosts()}),uiGmapGoogleMapApi.then(function(map){$timeout(function(){$scope.showMap=!0},100)}),$scope.imgLoadedEvents={always:function(instance){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded-ed animated fadeIn"),$rootScope.$broadcast("masonry.reload")},fail:function(instance){}},$scope.getTradeList=function(){$http({url:"https://"+URL_BASE+"api/tradelist",method:"GET"}).then(function(data){data.data.tradelists&&($scope.tradelist=data.data.tradelists)}).then(function(error){console.log(error)})},$scope.getTradeList(),$scope.addToTradeList=function(){$http({url:"https://"+URL_BASE+"/api/tradelist",method:"POST",data:{item:$scope.newItem}}).then(function(data){console.log(data.data),$scope.tradelist.push(data.data),$scope.newItem=""}).then(function(error){console.log(error)})},$scope.deleteFromTradeList=function(item){$http({url:"https://"+URL_BASE+"/api/tradelist/delete/"+item.id,method:"GET"}).then(function(data){$scope.tradelist.splice($scope.tradelist.indexOf(item),1)}).then(function(error){console.log(error)})},$scope.loadMorePosts=function(){if($rootScope.currentUser.hasOwnProperty("id")){if($scope.isBusy===!0)return;$scope.isBusy=!0,noMorePosts||($http({url:"https://"+URL_BASE+"api/posts?page="+$scope.currentPage+"&user-id="+$scope.currentUser.id,method:"GET"}).then(function(data){Array.prototype.push.apply($scope.posts,data.data.posts),console.log($scope.posts),data.data.posts.length<4&&(noMorePosts=!0),$scope.isBusy=!1},function(error){$scope.response=error.data}),$scope.currentPage++)}},$rootScope.addRoute=function(url){return"https://www.blackmarketu.com/"+url},$scope.updateUser=function(){$http({url:"https://blackmarketu.com/api/users/edit/user-information",method:"POST",data:{bio:$scope.currentUser.bio,username:$scope.currentUser.username}}).then(function(data){alert("Account updated!"),UserService.getUser()}).then(function(error){console.log(error)})},$scope.updatePasswords=function(){$http({url:"https://www.blackmarketu.com/api/users/edit/user-password",method:"POST",data:{password:$scope.updatePassword.oldpassword,"n-password":$scope.updatePassword.newpassword,"n-password-check":$scope.updatePassword.passwordagain}}).then(function(data){UserService.changePassword(data)}).then(function(error){console.log(error)})}}]),angular.module("bmuApp").controller("changeProPic",["$scope","$uibModal","$log","Upload",function($scope,$uibModal,$log,Upload){$scope.animationsEnabled=!0,$scope.open=function(_currentUser){var modalInstance=$uibModal.open({animation:$scope.animationsEnabled,templateUrl:"changeProPic.html",controller:"ProPicModalInstanceCtrl",resolve:{user:function(){return _currentUser}}});modalInstance.result.then(function(){},function(){$log.info("Modal dismissed at: "+new Date)})},$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled}}]),angular.module("bmuApp").controller("ProPicModalInstanceCtrl",["$scope","$http","$state","Upload","$rootScope","$uibModalInstance","user",function($scope,$http,$state,Upload,$rootScope,$uibModalInstance,user){$scope.user={},$scope.imageError=!1,$scope.posting=!1,$scope.errorString="",$scope.error=function(message){var str=JSON.stringify(message);$scope.errorString=str.replace(/^"(.+(?="$))"$/,"$1")},$scope.uploadPic=function(dataUrl){console.log(dataUrl),$scope.imageError=!1,$scope.user=user,$scope.posting=!0,Upload.upload({url:"https://blackmarketu.com/api/users/edit/profile-picture",data:{"profile-image":dataUrl}}).then(function(response){$scope.posting=!1,$scope.close()},function(response){response.status>0&&($scope.errorMsg=response.status+": "+JSON.stringify(response.data)),$scope.posting=!1,console.log($scope.errorMsg.error)},function(evt){})},$scope.close=function(){$uibModalInstance.dismiss("cancel")},$scope.cancel=function(){$uibModalInstance.dismiss("cancel")}}]),angular.module("bmuApp.profile").controller("otherprofilecontroller",["$scope","$http","$state","UserService","Upload","$rootScope","$stateParams","URL_BASE",function($scope,$http,$state,UserService,Upload,$rootScope,$stateParams,URL_BASE){$scope.hasPosts=!1;var noMorePosts=!1;$scope.hasPosts=!1,$scope.currentPage=0,$scope.posts=[],$scope.isBusy=!1,$scope.updatePassword={},$scope.newItem,$scope.tradelist=[],$scope.otherUser={},$scope.imgLoadedEvents={always:function(instance){},done:function(instance){angular.element(instance.elements[0]).addClass("loaded-ed animated fadeIn"),$rootScope.$broadcast("masonry.reload")},fail:function(instance){}},$rootScope.addRoute=function(url){return"https://www.blackmarketu.com/"+url},$scope.privateMessenger=function(userId){userId!=UserService.currentUser().id?$state.go("newMessageState",{id:userId}):console.log("your post idiot")},$scope.loadMorePosts=function(){$scope.isBusy!==!0&&($scope.isBusy=!0,noMorePosts||($http({url:"https://"+URL_BASE+"api/posts?page="+$scope.currentPage+"&user-id="+$stateParams.id,method:"GET"}).then(function(data){Array.prototype.push.apply($scope.posts,data.data.posts),console.log($scope.posts),data.data.posts.length<4&&(noMorePosts=!0),$scope.isBusy=!1},function(error){$scope.response=error.data}),$scope.currentPage++))},$scope.getTradeList=function(){$http({url:"https://"+URL_BASE+"api/tradelist",method:"GET"}).then(function(data){$scope.tradelist=data.data.tradelists}).then(function(error){console.log(error)})},$scope.getTradeList(),$http({url:"https://www.blackmarketu.com/api/users/"+$stateParams.id,method:"GET"}).then(function(data){$scope.currentUser=data.data}).then(function(error){console.log(error)}),console.log($scope.currentUser)}]),angular.module("bmuApp.signup",["ui.router","angular-storage","ngFileUpload"]).controller("signupcontroller",["$scope","$state","UserService","Upload","$rootScope",function($scope,$state,UserService,Upload,$rootScope){$scope.user={},$scope.imageError=!1,$scope.posting=!1,$scope.errorString="",$scope.error=function(message){var str=JSON.stringify(message);$scope.errorString=str.replace(/^"(.+(?="$))"$/,"$1")},$scope.uploadPic=function(dataUrl){console.log(dataUrl),$scope.imageError=!1,user=$scope.user,$scope.data={email:user.email,"first-name":user.firstName,"last-name":user.lastName,username:user.username,"password-init":user.password,"school-id":user.schoolId,"grad-class":user.gradClass},$scope.posting=!0,Upload.upload({url:"https://blackmarketu.com/api/create-account",data:{"profile-image":dataUrl,email:user.email,"first-name":user.firstName,"last-name":user.lastName,username:user.username,"password-init":user.password,"password-check":user.passwordCheck,"school-id":user.schoolId,"grad-class":user.gradClass}}).then(function(response){$scope.posting=!1,$state.go("loginState",{message:"Please check your email to activate your account!"})},function(response){response.status>0&&($scope.errorMsg=response.status+": "+JSON.stringify(response.data)),$scope.posting=!1,console.log($scope.errorMsg.error)},function(evt){})}}]),angular.module("bmuApp.login").run(["$rootScope","UserService","$state",function($rootScope,UserService,$state){$rootScope.$watch(UserService.isLoggedIn,function(isLoggedIn){$rootScope.currentUser=UserService.currentUser(),$rootScope.isLoggedIn=isLoggedIn,$rootScope.isLoggedIn&&("loginState"!=$state.current.name&&"signupState"!=$state.current.name||$state.go("postState"))})}]),angular.module("bmuApp").directive("eduEmail",function(){function checkEdu(value){return console.log(value),value.indexOf("@")>-1&&-1!=value.indexOf(".")?(str=value.split("@"),str2=str[1].split("."),"edu"==str2[str2.length-1]):!1}return{require:"ngModel",restrict:"",link:function(scope,elm,attrs,ctrl){ctrl&&ctrl.$validators.email&&(ctrl.$validators.email=function(modelValue){return ctrl.$isEmpty(modelValue)||checkEdu(modelValue)})}}}),angular.module("bmuApp").directive("username",["$http","$q",function($http,$q){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$asyncValidators.username=function(modelValue,viewValue){return $http.post("https://www.blackmarketu.com/api/verify/username",{username:viewValue}).then(function(response){return console.log(response),"1"===response.data?$q.reject(response.data.errorMessage):!0})}}}}]),angular.module("bmuApp").directive("email",["$http","$q",function($http,$q){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$asyncValidators.email=function(modelValue,viewValue){return $http.post("https://www.blackmarketu.com/api/verify/email",{email:viewValue}).then(function(response){return"1"===response.data?$q.reject(response.data.errorMessage):!0})}}}}]),angular.module("bmuApp").directive("equals",function(){return{restrict:"A",require:"?ngModel",link:function(scope,elem,attrs,ngModel){if(ngModel){scope.$watch(attrs.ngModel,function(){validate()}),attrs.$observe("equals",function(val){validate()});var validate=function(){var val1=ngModel.$viewValue,val2=attrs.equals;ngModel.$setValidity("equals",!val1||!val2||val1===val2)}}}}}),angular.module("bmuApp").factory("UserService",["$http","URL_BASE","$http","store","$state","URL_BASE",function($http,URL_BASE,$http,store,$state,URL_BASE){var currentUser={},loggedIn=!1;
return{createUser:function(){$state.go("loginState")},login:function(user){var self=this;$http({url:"https://"+URL_BASE+"/api/login",method:"POST",data:user}).then(function(response){return loggedIn=!0,store.set("jwt",response.data.data.token),self.getUser(),$state.go("postState"),!0},function(error){return!1})},getUser:function(){var self=this;null!==store.get("jwt")&&$http({url:"https://"+URL_BASE+"api/users",method:"GET"}).then(function(data){currentUser=data.data,loggedIn=!0},function(error){self.logout()})},logout:function(){loggedIn=!1,store.remove("jwt"),$state.go("homeState")},changePassword:function(data){store.remove("jwt"),store.set("jwt",data.data)},setLoggedIn:function(){loggedIn=!0},isLoggedIn:function(){return loggedIn},currentUser:function(){return currentUser}}}]);